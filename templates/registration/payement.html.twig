{% extends 'base.html.twig' %}

{% block title %}Register{% endblock %}

{% block body %}
    <h1>Pour finaliser votre inscription 1 mois gratuit. Insérer votre moyen de paiement</h1>
    // todo obfuscer le javascript
<div id="paypal-button-container-P-7CS83708LT127815SMOWK6YQ"></div>
<script src="https://www.paypal.com/sdk/js?client-id=AVrLhX2dc7X1GxwOYkRMT2gCGzmgaRFRFsX8SbRb6YW0vM923A-FoitNjkVhI0tPV5UzKEAD_kQRcCUL&vault=true&intent=subscription" data-sdk-integration-source="button-factory"></script>
<script>
    paypal.Buttons({
        style: {
            shape: 'pill',
            color: 'white',
            layout: 'horizontal',
            label: 'subscribe'
        },
        createSubscription: function(data, actions) {
            return actions.subscription.create({
                /* Creates the subscription */
                plan_id: 'P-7CS83708LT127815SMOWK6YQ'
            });
        },
        onApprove: function(data, actions) {
            //alert(data.subscriptionID); // You can add optional success message for the subscriber here

            const xhttp = new XMLHttpRequest();
            xhttp.open("POST", "/payement?subId=" + data.subscriptionID);
            xhttp.send();

            alert("Inscription réussi vous pouvez vous connecter");
            window.location.replace("/login");

        }
    }).render('#paypal-button-container-P-7CS83708LT127815SMOWK6YQ'); // Renders the PayPal button
</script>

{% endblock %}